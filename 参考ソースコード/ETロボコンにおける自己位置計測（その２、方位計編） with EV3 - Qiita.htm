<!DOCTYPE HTML>
<!-- saved from url=(0058)http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241 -->
<!DOCTYPE html PUBLIC "" ""><HTML xmlns:og="http://ogp.me/ns#"><HEAD><META 
content="IE=11.0000" http-equiv="X-UA-Compatible">

<META charset="UTF-8"><TITLE>ETロボコンにおける自己位置計測（その２、方位計編） with EV3 - Qiita</TITLE>
<META name="viewport" content="width=device-width,initial-scale=1">
<META name="description" content="&#10;&#10;方位計&#10;&#10;&#10;方位計の概要&#10;&#10;　さて、距離計に続いて今度は方位計です。これは「走行体は今、どの方向（方位）を向いているのか」を計測する計測器です。これも距離計と大体の考え方は同じですが、走行体の「全体の動き」から考えていかなければならないので、少し難しいです。以下の図のような状況を考えてみましょう。&#10;&#10;&#10;&#10;　それでは、図のように走行体が弧を描いたように旋回して移動したと考えます。その移動の軌跡を上から眺めているとします。この時に描かれる走行体の移動軌跡の弧も「大きな円...">
<META name="twitter:card" content="summary">
<META name="twitter:site" content="@Qiita">
<META name="twitter:creator" content="PsychoGundam009">
<META content="ETロボコンにおける自己位置計測（その２、方位計編） with EV3 - Qiita" property="og:title">
<META content="article" property="og:type">
<META content="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241" 
property="og:url">
<META content="http://cdn.qiita.com/assets/qiita-fb-2887e7b4aad86fd8c25cea84846f2236.png" 
property="og:image">
<META content="# 方位計&#10;## 方位計の概要&#10;　さて、距離計に続いて今度は方位計です。これは「走行体は今、どの方向（方位）を向いているのか」を計測する計測器です。これも距離計と大体の考え方は同じですが、走行体の「全体の動き」から考えていかなければな..." 
property="og:description">
<META content="Qiita" property="og:site_name">
<META content="564524038" property="fb:admins"><LINK href="http://cdn.qiita.com/assets/favicons/public/production-4ff10c1e1e2b5fcb353ff9cafdd56c70.ico" 
rel="shortcut icon" type="image/x-icon"><LINK href="http://cdn.qiita.com/assets/favicons/public/apple-touch-icon-f9a6afad761ec2306e10db2736187c8b.png" 
rel="apple-touch-icon" type="image/png"><LINK title="Qiita" href="/opensearch.xml" 
rel="search" type="application/opensearchdescription+xml"><LINK href="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/public-8f6b46e6e87d7bfce95ce8f6e214fde2.min.css" 
rel="stylesheet" media="all">
<META name="csrf-param" content="authenticity_token"> 
<META name="csrf-token" content="PO5PNmAVzwYOpWx/h0Ou4Nlcv6Fp9OH8CxG/e8kycCz7O6S+HSjz6Jiuam4ClrluoKehGcjO7O0DuGH8zZBwpg==">
<META name="GENERATOR" content="MSHTML 11.00.9600.18666"></HEAD>
<BODY class="without-js"><NOSCRIPT>&lt;iframe height="0" 
src="//www.googletagmanager.com/ns.html?id=GTM-TBQWPN" 
style="display:none;visibility:hidden" width="0"&gt;&lt;/iframe&gt;</NOSCRIPT>
<SCRIPT>
  document.body.className = document.body.className.replace('without-js', '') + ' with-js';
  window.Qiita = {"asset_host":"cdn.qiita.com","TLD":"com","controller_path":"public/items","controller_action":"public/items#show","controller":"items","action":"show","action_path":"public/items#show","env":"production","flash":{},"is_team_page":false,"request_parameters":{"controller":"public/items","action":"show","user_id":"TetsuroAkagawa","type":"items","id":"4e7de30523d9c7ec6241"},"root_domain":"qiita.com","variant":null,"config":{"mixpanel":{"career":"dd35af27e959781713d63fd7ca898a8d","per_team":"c0a2116368b33b44b5029ebd2cc9b094","public":"be87616606b0e26a87689099aab2c4e5","team":"b7c0342acba2dbc8742484d98788efb3"},"default_locale":"ja","locale":"ja"},"team":null,"user":null,"GIT_BRANCH":null,"DEBUG":false};

</SCRIPT>
 
<DIV class="headerContainer headerContainer-public" role="navigation">
<SCRIPT class="js-react-on-rails-component" type="application/json">{"component_name":"HeaderContainer","props":{"user":null,"team":null,"news":{"type":"募集","content":"QiitaやQiita:Teamを良くしたいエンジニア","url":"http://increments.co.jp/jobs/engineers?utm_source=qiita\u0026utm_medium=header_news"},"initial_unread_count":null,"siteid_image":"http://cdn.qiita.com/siteid-reverse.png","is_team_page":false,"on_team_setting":false,"show_post_menu":true,"show_search_menu":true,"is_fluid":false,"locale":"ja"},"trace":false,"dom_id":"HeaderContainer-react-component-8399c6a2-ff61-4ef3-8f55-d68ab2d1480f"}</SCRIPT>
     
<DIV 
id="HeaderContainer-react-component-8399c6a2-ff61-4ef3-8f55-d68ab2d1480f"></DIV></DIV>
<DIV id="main">
<SCRIPT type="application/ld+json">{  "@context": "http://schema.org",  "@type": "BreadcrumbList",  "itemListElement": [    {      "@type": "ListItem",      "position": 1,      "item": {        "@id": "/",        "name": "Qiita"      }    },    {      "@type": "ListItem",      "position": 2,      "item": {        "@id": "/items",        "name": "投稿"      }    },    {      "@type": "ListItem",      "position": 3,      "item": {        "@id": "/tags/ET%E3%83%AD%E3%83%9C%E3%82%B3%E3%83%B3",        "name": "ETロボコン"      }    }  ]}</SCRIPT>
<ARTICLE itemtype="http://schema.org/Article" itemscope="">
<DIV class="ArticleMainHeader ">
<DIV class="container"></DIV>
<DIV class="container">
<DIV class="row s-flex-align-center">
<DIV class="col-sm-9">
<H1 class="ArticleMainHeader__title" 
itemprop="headline">ETロボコンにおける自己位置計測（その２、方位計編） with EV3</H1>
<UL class="TagList">
  <LI class="TagList__item" data-count="39"><A class="u-link-unstyled TagList__label" 
  href="http://qiita.com/tags/ET%E3%83%AD%E3%83%9C%E3%82%B3%E3%83%B3"><IMG 
  class="TagList__icon" alt="ETロボコン" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/missing-2e17009a0b32a6423572b0e6dc56727e.png"><SPAN>ETロボコン</SPAN></A></LI>
  <LI class="TagList__item" data-count="61"><A class="u-link-unstyled TagList__label" 
  href="http://qiita.com/tags/EV3"><IMG class="TagList__icon" alt="EV3" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/missing-2e17009a0b32a6423572b0e6dc56727e.png"><SPAN>EV3</SPAN></A></LI>
  <LI class="TagList__item" data-count="20"><A class="u-link-unstyled TagList__label" 
  href="http://qiita.com/tags/EV3RT"><IMG class="TagList__icon" alt="EV3RT" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/missing-2e17009a0b32a6423572b0e6dc56727e.png"><SPAN>EV3RT</SPAN></A></LI>
  <LI class="TagList__item" data-count="42"><A class="u-link-unstyled TagList__label" 
  href="http://qiita.com/tags/TOPPERS"><IMG class="TagList__icon" alt="TOPPERS" 
  src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/missing-2e17009a0b32a6423572b0e6dc56727e.png"><SPAN>TOPPERS</SPAN></A></LI></UL></DIV>
<DIV class="col-sm-3">
<DIV class="itemsShowHeaderStock">
<UL class="list-unstyled itemsShowHeaderStock_statusList">
  <LI>
  <DIV class="itemsShowHeaderStock_count stock"><SPAN 
  class="fa fa-thumbs-up"></SPAN><SPAN class="js-likecount">2</SPAN></DIV>
  <DIV class="itemsShowHeaderStock_countText">いいね</DIV></LI>
  <LI>
  <DIV class="itemsShowHeaderStock_count" itemprop="commentCount" content="0 UserComments"><SPAN 
  class="fa fa-comment"></SPAN>0</DIV>
  <DIV class="itemsShowHeaderStock_countText">コメント</DIV></LI></UL></DIV>
<DIV class="js-likebutton" data-props='{"like_status":false,"like_count":2,"uuid":"4e7de30523d9c7ec6241","likable_type":"Article","position":"article-header"}'></DIV>
<UL class="list-inline ArticleMainHeader__users">
  <LI class="js-hovercard" data-hovercard-target-name="From_F"><A href="http://qiita.com/From_F" 
  itemprop="url"><IMG class="thumb thumb--xs" alt="From_F" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/1473689267.jpg"></A></LI>
  <LI class="js-hovercard" data-hovercard-target-name="mossandayo"><A href="http://qiita.com/mossandayo" 
  itemprop="url"><IMG class="thumb thumb--xs" alt="mossandayo" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/1476924209.png"></A></LI></UL></DIV></DIV></DIV></DIV>
<DIV class="ArticleAsideHeader">
<DIV class="container">
<DIV class="u-flex u-space-between">
<DIV class="u-flex u-flex-wrap">
<DIV class="u-flex u-align-center s-pdv-5 u-flex-wrap">
<DIV class="ArticleAsideHeader__author"><A href="http://qiita.com/TetsuroAkagawa"><IMG 
class="thumb thumb--xs" alt="5qjm6plv normal" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/5QJm6PLv_normal.jpg"></A> 
<A class="u-link-unstyled" 
href="http://qiita.com/TetsuroAkagawa">TetsuroAkagawa</A> </DIV>
<DIV class="ArticleAsideHeader__date">
<META content="2016-12-27T16:17:18+09:00" itemprop="datePublished"><SPAN title="2016年12月27日に投稿" 
data-toggle="tooltip"><time itemprop="dateModified" datetime="2017-01-14T12:23:55+09:00">2017年01月14日</time>に更新</SPAN></DIV></DIV>
<DIV class="u-flex u-align-center s-pdv-5 mobile-hidden">
<DIV class="ArticleAsideHeader__revision"><A title="編集履歴" href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241/revisions" 
data-toggle="tooltip"><SPAN class="fa fa-history"></SPAN></A><SPAN class="ArticleAsideHeader__revisionCount">13</SPAN></DIV></DIV>
<DIV class="u-flex u-align-center s-pdv-5 mobile-hidden"></DIV></DIV>
<DIV class="u-flex u-align-center s-flex-justiry-between s-pdv-5 u-shrink-0">
<DIV class="ArticleAsideHeader__stock">
<DIV class="js-stockbutton" data-props='{"stock_status":false}' data-position="top"></DIV></DIV>
<DIV class="dropdown"><A class="dropdown-toggle" href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241#" 
data-toggle="dropdown"><SPAN class="fa fa-ellipsis-h fa-lg"></SPAN></A>
<UL class="dropdown-menu dropdown-menu-right">
  <LI class="dropdown__item--mobile"><A href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241/revisions"><SPAN 
  class="fa fa-fw fa-history"></SPAN> 編集履歴<SPAN>(13)</SPAN></A></LI>
  <LI><A 
  href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241.md"><SPAN 
  class="fa fa-fw fa-file-text-o"></SPAN> Markdownで本文を見る</A></LI>
  <LI><A href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241#" 
  data-toggle="modal" data-target=".js-report-form"><SPAN class="fa fa-fw fa-flag"></SPAN> 
  問題がある投稿を報告する</A></LI></UL></DIV></DIV></DIV></DIV></DIV>
<DIV class="container">
<DIV class="row" id="article-body-wrapper">
<DIV class="col-sm-9"><SECTION class="markdownContent markdownContent-headingEnabled js-task-list-container clearfix position-relative" 
id="item-4e7de30523d9c7ec6241" itemprop="articleBody">
<H1><SPAN class="fragment" id="方位計"></SPAN><A href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241#%E6%96%B9%E4%BD%8D%E8%A8%88"><I 
class="fa fa-link"></I></A>方位計</H1>
<H2><SPAN class="fragment" id="方位計の概要"></SPAN><A href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241#%E6%96%B9%E4%BD%8D%E8%A8%88%E3%81%AE%E6%A6%82%E8%A6%81"><I 
class="fa fa-link"></I></A>方位計の概要</H2>
<P>　さて、距離計に続いて今度は方位計です。これは「走行体は今、どの方向（方位）を向いているのか」を計測する計測器です。これも距離計と大体の考え方は同じですが、走行体の「全体の動き」から考えていかなければならないので、少し難しいです。以下の図のような状況を考えてみましょう。</P>
<P><A href="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/70c37eff-dfb2-80a7-2226-2afe050bcc89.png" 
target="_blank" rel="nofollow noopener"><IMG alt="houi2.png" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/70c37eff-dfb2-80a7-2226-2afe050bcc89.png"></A></P>
<P>　それでは、図のように走行体が弧を描いたように旋回して移動したと考えます。その移動の軌跡を上から眺めているとします。この時に描かれる走行体の移動軌跡の弧も「大きな円（旋回円）の一部」と考えられます。この旋回円の一部として考えたときの弧の形は、扇形になります。そして、その扇形の中心角こそが走行体の方位角度になるのです。よって、扇形の公式から方位角度は以下のようになります。</P>
<DIV class="code-frame" data-lang="math">
<DIV class="highlight">
<PRE>走行体の方位角度 = 360 * \frac{扇形の弧の長さ}{2 \pi * 旋回円の半径　　　　}　　　　　　　　　　　　　 (1)
</PRE></DIV></DIV>
<P>　これで方位角度を出そうとすると、「扇形の弧の長さ」は走行体の移動距離となるのでいいのですが、「旋回円の半径」がちょっと厄介です。ですので、これから「旋回円の半径」がいらない形へと式を変形する手順を説明します。特に知る必要がない場合は、この欄は読み飛ばしてください。</P>
<H2><SPAN class="fragment" id="方位計の式変形"></SPAN><A href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241#%E6%96%B9%E4%BD%8D%E8%A8%88%E3%81%AE%E5%BC%8F%E5%A4%89%E5%BD%A2"><I 
class="fa fa-link"></I></A>方位計の式変形</H2>
<P>　実際は車輪が二つあることから、この弧の軌跡によってできる旋回円は二重丸の形になります。そこで、この二つの旋回円でもって連立方程式を解くことで「旋回円の半径」を式から消すことができます。まずは、左右車輪それぞれに対しての計算式を式(1)を当てはめて考えてみましょう。</P>
<DIV class="code-frame" data-lang="math">
<DIV class="highlight">
<PRE>走行体の方位角度 = 360 * \frac{右タイヤの移動距離}{2 \pi * 右タイヤの旋回円の半径　　　　　　　　}　　　　　　　　(2)
</PRE></DIV></DIV>
<DIV class="code-frame" data-lang="math">
<DIV class="highlight">
<PRE>走行体の方位角度 = 360 * \frac{左タイヤの移動距離}{2 \pi * 左タイヤの旋回円の半径　　　　　　　　}　　　　　　　　(3)
</PRE></DIV></DIV>
<P>　この時点では、まだ「旋回円の半径」が残ってしまっています。しかし、この状況を「左側へ曲がって旋回している状況」として考えてみてください。すると、右タイヤの旋回円は二重丸の外側の円となります。これにより「右タイヤの旋回円の半径 
= 左タイヤの旋回円の半径 + 走行体のトレッド幅」と読み解くことができます。よって、式(2)は以下のようになります。</P>
<DIV class="code-frame" data-lang="math">
<DIV class="highlight">
<PRE>走行体の方位角度 = 360 * \frac{右タイヤの移動距離}{2 \pi * (左タイヤの旋回円の半径 + 走行体のトレッド幅)　　　　　　　　　　　　　　　　}　　　(4)
</PRE></DIV></DIV>
<P>　あとはこの式(4)と式(3)とで「左タイヤの旋回円の半径」が無くなるように連立方程式を解くだけです。すると、方位角度を表す式は以下の式(5)のようになります。</P>
<DIV class="code-frame" data-lang="math">
<DIV class="highlight">
<PRE>走行体の方位角度 = \frac{360}{　2 \pi * 走行体のトレッド幅　}  * (左タイヤの移動距離 - 右タイヤの移動距離)　　　　(5)
</PRE></DIV></DIV>
<P>　ここでは「左側へ曲がって旋回している状況」を例に挙げて式を出しましたが、「右側に曲がって旋回している状況」でもこの式のまま使うことができます。その場合は「左タイヤの移動距離 
- 右タイヤの移動距離」の部分が負の値を持ち、方位角度も負の値となります。</P>
<H2><SPAN class="fragment" id="方位計のサンプルプログラム"></SPAN><A href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241#%E6%96%B9%E4%BD%8D%E8%A8%88%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0"><I 
class="fa fa-link"></I></A>方位計のサンプルプログラム</H2>
<P>　サンプルプログラムでは上記の式(5)の計算式を行っているだけです。左右車輪の走行距離は、距離計の記事※1で作成した関数を使って、左右車輪の走行距離を取得します。<BR>※1 
「ETロボコンにおける自己位置計測（その1、距離計編） with EV3」<BR>ー <A class="autolink" id="reference-9f8eb43c5494e8fdd314" 
href="http://qiita.com/PsychoGundam009/private/ba6190f08d26df7cc8ad">http://qiita.com/PsychoGundam009/private/ba6190f08d26df7cc8ad</A></P>
<P>　この方位計においても、4ms周期で更新する関数を呼び出し、4ms間の方位の変化量を足し合わせることによって、全体の方位角度を算出しています。</P>
<P><A href="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/b353cb5f-7e7d-5252-53b9-683f87520505.png" 
target="_blank" rel="nofollow noopener"><IMG alt="houi.png" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/b353cb5f-7e7d-5252-53b9-683f87520505.png"></A></P>
<DIV class="code-frame" data-lang="c">
<DIV class="code-lang"><SPAN class="bold">Direction.c</SPAN></DIV>
<DIV class="highlight">
<PRE><SPAN class="cp">#include "Direction.h"</SPAN>

<SPAN class="cp">#define TREAD 132.6 </SPAN><SPAN class="c1">//車体トレッド幅(132.6mm)</SPAN>

<SPAN class="k">static</SPAN> <SPAN class="kt">float</SPAN> <SPAN class="n">direction</SPAN> <SPAN class="o">=</SPAN> <SPAN class="mf">0.0</SPAN><SPAN class="p">;</SPAN> <SPAN class="c1">//現在の方位</SPAN>

 <SPAN class="cm">/* 初期化 */</SPAN>
<SPAN class="kt">void</SPAN> <SPAN class="nf">Direction_init</SPAN><SPAN class="p">(){</SPAN>
    <SPAN class="n">direction</SPAN> <SPAN class="o">=</SPAN> <SPAN class="mf">0.0</SPAN><SPAN class="p">;</SPAN>
<SPAN class="p">}</SPAN>

 <SPAN class="cm">/* 方位を取得(右旋回が正転) */</SPAN>
<SPAN class="kt">float</SPAN> <SPAN class="nf">Direction_getDirection</SPAN><SPAN class="p">(){</SPAN>
    <SPAN class="k">return</SPAN> <SPAN class="n">direction</SPAN><SPAN class="p">;</SPAN>
<SPAN class="p">}</SPAN>

<SPAN class="cm">/* 方位を更新 */</SPAN>
<SPAN class="kt">void</SPAN> <SPAN class="nf">Direction_update</SPAN><SPAN class="p">(){</SPAN>
    <SPAN class="c1">//(360 / (2 * 円周率 * 車体トレッド幅)) * (右進行距離 - 左進行距離)</SPAN>
    <SPAN class="n">direction</SPAN> <SPAN class="o">+=</SPAN> <SPAN class="p">(</SPAN><SPAN class="mf">360.0</SPAN> <SPAN class="o">/</SPAN> <SPAN class="p">(</SPAN><SPAN class="mf">2.0</SPAN> <SPAN class="o">*</SPAN> <SPAN class="n">PI</SPAN> <SPAN class="o">*</SPAN> <SPAN class="n">TREAD</SPAN><SPAN class="p">))</SPAN> <SPAN class="o">*</SPAN> <SPAN class="p">(</SPAN><SPAN class="n">Distance_getDistance4msLeft</SPAN><SPAN class="p">()</SPAN> <SPAN class="o">-</SPAN> <SPAN class="n">Distance_getDistance4msRight</SPAN><SPAN class="p">());</SPAN>
<SPAN class="p">}</SPAN>
</PRE></DIV></DIV>
<DIV class="code-frame" data-lang="c">
<DIV class="code-lang"><SPAN class="bold">Direction.h</SPAN></DIV>
<DIV class="highlight">
<PRE><SPAN class="cp">#ifndef _DIRECTION_H_</SPAN>
<SPAN class="cp">#define _DIRECTION_H_</SPAN>

<SPAN class="cp">#include "parameter.h"</SPAN>
<SPAN class="cp">#include "Distance.h"</SPAN>

<SPAN class="cm">/* 初期化 */</SPAN>
<SPAN class="kt">void</SPAN> <SPAN class="nf">Direction_init</SPAN><SPAN class="p">();</SPAN>

<SPAN class="cm">/* 方位を取得(右旋回が正転) */</SPAN>
<SPAN class="kt">float</SPAN> <SPAN class="nf">Direction_getDirection</SPAN><SPAN class="p">();</SPAN>

 <SPAN class="c1">// 方位を更新</SPAN>
<SPAN class="kt">void</SPAN> <SPAN class="nf">Direction_update</SPAN><SPAN class="p">();</SPAN>

<SPAN class="cp">#endif</SPAN>

</PRE></DIV></DIV>
<H2><SPAN class="fragment" id="方位計プログラムの実行例動画"></SPAN><A href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241#%E6%96%B9%E4%BD%8D%E8%A8%88%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E5%AE%9F%E8%A1%8C%E4%BE%8B%E5%8B%95%E7%94%BB"><I 
class="fa fa-link"></I></A>方位計プログラムの実行例（動画）</H2>
<P>180度旋回します。<BR><A href="http://www.youtube.com/watch?v=dwVCUnBwGAs" target="_blank" 
rel="nofollow noopener"><IMG alt="IMAGE ALT TEXT HERE" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/0.jpg"></A></P>
<P>以下が、その実行コード（一部抜粋）になります。</P>
<DIV class="code-frame" data-lang="text">
<DIV class="highlight">
<PRE>typedef enum {
    TURN,
    END
} RUN_STATE;

void main_task(intptr_t unused) {
    static RUN_STATE state = TURN;

    /* モーター出力ポートの設定 */
    ev3_motor_config(left_motor, LARGE_MOTOR);
    ev3_motor_config(right_motor, LARGE_MOTOR);

    /* 計測器初期化 */
    Distance_init();
    Direction_init();

    while(1) {
        /* 計測器更新 */
        Distance_update();
        Direction_update();

        switch(state) {
        case TURN:
            ev3_motor_set_power(left_motor, 30);
            ev3_motor_set_power(right_motor, -30);
            if( Direction_getDirection() &gt; 180.0) {;
                state = END;
            }
            break;
        case END:
            ev3_motor_stop(left_motor, true);
            ev3_motor_stop(right_motor, true);
            break;
        default:
            break;
        }
    }
}
</PRE></DIV></DIV>
<DIV class="hidden">
<FORM class="js-task-list-update" action="/TetsuroAkagawa/items/4e7de30523d9c7ec6241" 
method="post" 
accept-charset="UTF-8"><INPUT name="utf8" type="hidden" value="✓"><INPUT name="_method" type="hidden" value="patch"><INPUT name="authenticity_token" type="hidden" value="8AG2jzqTmTaP52oXidwHivFGqV0Rmc+OnXKcSw1mqdE31F0HR66l2BnsbAYMCRAEiL235bCjwp+V20LMCcSpWw=="><INPUT name="updated_at_confirmation_in_unixtime" class="js-task-list-updated-at" id="updated_at_confirmation_in_unixtime" type="hidden" value="1484364235"><TEXTAREA name="raw_body" class="js-task-list-field" id="raw_body"># 方位計
## 方位計の概要
　さて、距離計に続いて今度は方位計です。これは「走行体は今、どの方向（方位）を向いているのか」を計測する計測器です。これも距離計と大体の考え方は同じですが、走行体の「全体の動き」から考えていかなければならないので、少し難しいです。以下の図のような状況を考えてみましょう。

![houi2.png](https://qiita-image-store.s3.amazonaws.com/0/153774/70c37eff-dfb2-80a7-2226-2afe050bcc89.png)

　それでは、図のように走行体が弧を描いたように旋回して移動したと考えます。その移動の軌跡を上から眺めているとします。この時に描かれる走行体の移動軌跡の弧も「大きな円（旋回円）の一部」と考えられます。この旋回円の一部として考えたときの弧の形は、扇形になります。そして、その扇形の中心角こそが走行体の方位角度になるのです。よって、扇形の公式から方位角度は以下のようになります。

```math
走行体の方位角度 = 360 * \frac{扇形の弧の長さ}{2 \pi * 旋回円の半径　　　　}　　　　　　　　　　　　　 (1)
```
　これで方位角度を出そうとすると、「扇形の弧の長さ」は走行体の移動距離となるのでいいのですが、「旋回円の半径」がちょっと厄介です。ですので、これから「旋回円の半径」がいらない形へと式を変形する手順を説明します。特に知る必要がない場合は、この欄は読み飛ばしてください。

## 方位計の式変形
　実際は車輪が二つあることから、この弧の軌跡によってできる旋回円は二重丸の形になります。そこで、この二つの旋回円でもって連立方程式を解くことで「旋回円の半径」を式から消すことができます。まずは、左右車輪それぞれに対しての計算式を式(1)を当てはめて考えてみましょう。

```math
走行体の方位角度 = 360 * \frac{右タイヤの移動距離}{2 \pi * 右タイヤの旋回円の半径　　　　　　　　}　　　　　　　　(2)
```

```math
走行体の方位角度 = 360 * \frac{左タイヤの移動距離}{2 \pi * 左タイヤの旋回円の半径　　　　　　　　}　　　　　　　　(3)
```

　この時点では、まだ「旋回円の半径」が残ってしまっています。しかし、この状況を「左側へ曲がって旋回している状況」として考えてみてください。すると、右タイヤの旋回円は二重丸の外側の円となります。これにより「右タイヤの旋回円の半径 = 左タイヤの旋回円の半径 + 走行体のトレッド幅」と読み解くことができます。よって、式(2)は以下のようになります。

```math
走行体の方位角度 = 360 * \frac{右タイヤの移動距離}{2 \pi * (左タイヤの旋回円の半径 + 走行体のトレッド幅)　　　　　　　　　　　　　　　　}　　　(4)
```

　あとはこの式(4)と式(3)とで「左タイヤの旋回円の半径」が無くなるように連立方程式を解くだけです。すると、方位角度を表す式は以下の式(5)のようになります。

```math
走行体の方位角度 = \frac{360}{　2 \pi * 走行体のトレッド幅　}  * (左タイヤの移動距離 - 右タイヤの移動距離)　　　　(5)
```

　ここでは「左側へ曲がって旋回している状況」を例に挙げて式を出しましたが、「右側に曲がって旋回している状況」でもこの式のまま使うことができます。その場合は「左タイヤの移動距離 - 右タイヤの移動距離」の部分が負の値を持ち、方位角度も負の値となります。

## 方位計のサンプルプログラム
　サンプルプログラムでは上記の式(5)の計算式を行っているだけです。左右車輪の走行距離は、距離計の記事※1で作成した関数を使って、左右車輪の走行距離を取得します。
※1 「ETロボコンにおける自己位置計測（その1、距離計編） with EV3」
ー http://qiita.com/PsychoGundam009/private/ba6190f08d26df7cc8ad

　この方位計においても、4ms周期で更新する関数を呼び出し、4ms間の方位の変化量を足し合わせることによって、全体の方位角度を算出しています。

![houi.png](https://qiita-image-store.s3.amazonaws.com/0/153774/b353cb5f-7e7d-5252-53b9-683f87520505.png)

```Direction.c
#include "Direction.h"

#define TREAD 132.6 //車体トレッド幅(132.6mm)

static float direction = 0.0; //現在の方位

 /* 初期化 */
void Direction_init(){
	direction = 0.0;
}

 /* 方位を取得(右旋回が正転) */
float Direction_getDirection(){
	return direction;
}

/* 方位を更新 */
void Direction_update(){
	//(360 / (2 * 円周率 * 車体トレッド幅)) * (右進行距離 - 左進行距離)
	direction += (360.0 / (2.0 * PI * TREAD)) * (Distance_getDistance4msLeft() - Distance_getDistance4msRight());
}
```

```Direction.h
#ifndef _DIRECTION_H_
#define _DIRECTION_H_

#include "parameter.h"
#include "Distance.h"

/* 初期化 */
void Direction_init();

/* 方位を取得(右旋回が正転) */
float Direction_getDirection();

 // 方位を更新
void Direction_update();

#endif

```

##方位計プログラムの実行例（動画）
180度旋回します。
[![IMAGE ALT TEXT HERE](http://img.youtube.com/vi/dwVCUnBwGAs/0.jpg)](http://www.youtube.com/watch?v=dwVCUnBwGAs)

以下が、その実行コード（一部抜粋）になります。

```
typedef enum {
	TURN,
	END
} RUN_STATE;

void main_task(intptr_t unused) {
	static RUN_STATE state = TURN;

	/* モーター出力ポートの設定 */
	ev3_motor_config(left_motor, LARGE_MOTOR);
	ev3_motor_config(right_motor, LARGE_MOTOR);

	/* 計測器初期化 */
	Distance_init();
	Direction_init();

	while(1) {
		/* 計測器更新 */
		Distance_update();
		Direction_update();

		switch(state) {
		case TURN:
			ev3_motor_set_power(left_motor, 30);
			ev3_motor_set_power(right_motor, -30);
			if( Direction_getDirection() &gt; 180.0) {;
				state = END;
			}
			break;
		case END:
			ev3_motor_stop(left_motor, true);
			ev3_motor_stop(right_motor, true);
			break;
		default:
			break;
		}
	}
}
```
</TEXTAREA><INPUT name="commit" type="submit" value="Save changes" data-disable-with="Save changes"></FORM></DIV></SECTION></DIV>
<DIV class="col-sm-3">
<DIV class="socialButtons">
<DIV class="socialButtons_twitter"><A class="twitter-share-button" href="https://twitter.com/share" 
data-url="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241" data-text="ETロボコンにおける自己位置計測（その２、方位計編） with EV3 by @PsychoGundam009 on @Qiita">ツイート</A></DIV>
<DIV class="socialButtons_hatebu"><A title="はてブに追加" class="hatena-bookmark-button" 
href="http://b.hatena.ne.jp/entry/http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241" 
data-hatena-bookmark-title="ETロボコンにおける自己位置計測（その２、方位計編） with EV3" 
data-hatena-bookmark-layout="simple-balloon"><IMG width="20" height="20" style="border: currentColor; border-image: none;" 
alt="はてブに追加" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/button-only@2x.png"></A>
<SCRIPT src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/bookmark_button.js" type="text/javascript" charset="utf-8" async="async"></SCRIPT>
</DIV>
<DIV class="socialButtons_googlePlus">
<DIV class="g-plusone" data-size="medium" data-href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241"></DIV></DIV>
<DIV class="socialButtons_facebook">
<DIV class="fb-like" data-href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241" 
data-show-faces="false" data-share="false" data-layout="button_count" 
data-action="like"></DIV></DIV>
<DIV class="socialButtons_pocket"><A class="pocket-btn" data-lang="en" 
data-pocket-label="pocket" 
data-pocket-count="horizontal"></A></DIV></DIV><SECTION class="itemsShowAuthorInfo" 
itemtype="http://schema.org/Person" itemscope="" itemprop="author"><A href="http://qiita.com/TetsuroAkagawa"><IMG 
class="itemsShowAuthorInfo_userIcon" alt="" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/5QJm6PLv_normal.jpg" 
itemprop="image"></A>
<DIV class="itemsShowAuthorInfo_profileStats"><STRONG class="itemsShowAuthorInfo_userName" 
itemprop="name"><A href="http://qiita.com/TetsuroAkagawa" 
itemprop="url">TetsuroAkagawa</A></STRONG>
<DIV class="itemsShowAuthorInfo_contribution"><SPAN class="itemsShowAuthorInfo_count">9</SPAN><SPAN 
class="itemsShowAuthorInfo_unit">Contribution</SPAN></DIV>
<SCRIPT id="js-react-on-rails-context" type="application/json">null</SCRIPT>
 
<SCRIPT class="js-react-on-rails-component" type="application/json">{"component_name":"UserFollowButton","props":{"initial_followed_by":false,"position":"author-info","size":"btn-xs","url_name":"TetsuroAkagawa"},"trace":false,"dom_id":"UserFollowButton-react-component-694529d5-d30d-4991-b5af-379895920dc2"}</SCRIPT>
     
<DIV 
id="UserFollowButton-react-component-694529d5-d30d-4991-b5af-379895920dc2"></DIV></DIV><SECTION 
class="itemsShowAuthorPopularItems">
<H5 class="itemsShowAuthorPopularItems_sectionTitle">人気の投稿</H5>
<UL class="itemsShowAuthorPopularItems_posts list-unstyled">
  <LI itemtype="http://schema.org/Article" itemscope=""><A href="http://qiita.com/TetsuroAkagawa/items/ba6190f08d26df7cc8ad" 
  itemprop="url" data-label="AuthorPopularItemsAtSidebar" 
  track="click">ETロボコンにおける自己位置計測（その1、距離計編） with EV3</A></LI>
  <LI itemtype="http://schema.org/Article" itemscope=""><A href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241" 
  itemprop="url" data-label="AuthorPopularItemsAtSidebar" 
  track="click">ETロボコンにおける自己位置計測（その２、方位計編） with EV3</A></LI>
  <LI itemtype="http://schema.org/Article" itemscope=""><A href="http://qiita.com/TetsuroAkagawa/items/075d74f5ab49f592450b" 
  itemprop="url" data-label="AuthorPopularItemsAtSidebar" 
  track="click">ETロボコンにおける自己位置計測（その3、座標移動編） with EV3</A></LI>
  <LI itemtype="http://schema.org/Article" itemscope=""><A href="http://qiita.com/TetsuroAkagawa/items/1798c12e9517e6f1cbe9" 
  itemprop="url" data-label="AuthorPopularItemsAtSidebar" 
  track="click">ETロボコンにおける自己位置の応用（エリア分割） with EV3   
</A></LI></UL></SECTION></SECTION>
<DIV class="scroll-chaser">
<DIV class="ad_frame_right_banner_1"></DIV>
<SCRIPT src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/adjs_set_pro.js" defer="" type="text/javascript" charset="UTF-8" async=""></SCRIPT>
</DIV>
<SCRIPT class="js-react-on-rails-component" type="application/json">{"component_name":"Toc","props":{"body":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B9%E4%BD%8D%E8%A8%88\"\u003e方位計\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B9%E4%BD%8D%E8%A8%88%E3%81%AE%E6%A6%82%E8%A6%81\"\u003e方位計の概要\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B9%E4%BD%8D%E8%A8%88%E3%81%AE%E5%BC%8F%E5%A4%89%E5%BD%A2\"\u003e方位計の式変形\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B9%E4%BD%8D%E8%A8%88%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0\"\u003e方位計のサンプルプログラム\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#%E6%96%B9%E4%BD%8D%E8%A8%88%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E5%AE%9F%E8%A1%8C%E4%BE%8B%E5%8B%95%E7%94%BB\"\u003e方位計プログラムの実行例（動画）\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","wrapper":"#article-body-wrapper"},"trace":false,"dom_id":"Toc-react-component-34adbb58-6728-4097-96f5-eef8ee06e61c"}</SCRIPT>
     
<DIV 
id="Toc-react-component-34adbb58-6728-4097-96f5-eef8ee06e61c"></DIV></DIV></DIV>
<DIV class="row">
<DIV class="col-sm-9">
<DIV class="ArticleFooter__menu">
<DIV class="s-flex-align-center">
<DIV class="js-likebutton" data-props='{"like_status":false,"like_count":2,"show_count":true,"uuid":"4e7de30523d9c7ec6241","likable_type":"Article","position":"article-footer"}'></DIV>
<DIV class="ArticleFooter__userList">
<DIV class="ArticleFooter__user">
<DIV class="js-hovercard" data-hovercard-target-name="mossandayo"><A href="http://qiita.com/mossandayo" 
itemprop="url"><IMG class="thumb thumb--xs" alt="mossandayo" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/1476924209.png"></A></DIV></DIV>
<DIV class="ArticleFooter__user">
<DIV class="js-hovercard" data-hovercard-target-name="From_F"><A href="http://qiita.com/From_F" 
itemprop="url"><IMG class="thumb thumb--xs" alt="From_F" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/1473689267.jpg"></A></DIV></DIV></DIV></DIV>
<DIV class="u-flex u-align-center">
<DIV class="ArticleFooter__stock">
<DIV class="js-stockbutton" data-props='{"stock_status":false}' data-position="footer_menu"></DIV></DIV>
<DIV class="ArticleFooter__editRequest"><A title="投稿者に記事をより良くするための提案ができます 💪" 
class="u-link-no-underline" href="http://qiita.com/drafts/4e7de30523d9c7ec6241/edit" 
data-toggle="tooltip"><SPAN class="fa fa-send-o fa-lg"></SPAN> 
<SPAN>編集リクエスト</SPAN></A></DIV>
<DIV class="dropdown ArticleFooter__dropdown"><A class="dropdown-toggle" href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241#" 
data-toggle="dropdown"><SPAN class="fa fa-ellipsis-h"></SPAN></A>
<UL class="dropdown-menu dropdown-menu-right">
  <LI><A 
  href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241.md"><SPAN 
  class="fa fa-fw fa-file-text-o"></SPAN> Markdownで本文を見る</A></LI>
  <LI><A href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241#" 
  data-toggle="modal" data-target=".js-report-form"><I 
  class="fa fa-fw fa-flag"></I> 問題がある投稿を報告する</A></LI></UL></DIV></DIV></DIV>
<UL class="references js-referencesView">
  <LI class="references_header"><I class="fa fa-fw fa-link"></I> 
  この記事は以下の記事からリンクされています</LI>
  <LI class="references_reference js-reference"><A href="http://qiita.com/mossandayo/items/fab3c1fc2a97bb0fbcfc#_reference-dd395190c50ced340b0b"><IMG 
  width="18" height="18" alt="" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/1476924209.png">EV3に関する技術記事まとめ</A><SPAN>からリンク</SPAN><time 
  class="references_datetime js-dateTimeView" datetime="2017-01-16T00:39:29+00:00">5ヶ月前</time></LI>
  <LI class="references_reference js-reference"><A href="http://qiita.com/TetsuroAkagawa/items/075d74f5ab49f592450b#_reference-532cba1b37be8f3f3ba3"><IMG 
  width="18" height="18" alt="" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/5QJm6PLv_normal.jpg">ETロボコンにおける自己位置計測（その3、座標移動編） 
  with EV3</A><SPAN>からリンク</SPAN><time class="references_datetime js-dateTimeView" 
  datetime="2017-01-27T03:39:28+00:00">4ヶ月前</time></LI></UL>
<DIV class="itemsShowBody_articleColumnFooter">
<DIV class="socialButtons">
<DIV class="socialButtons_twitter"><A class="twitter-share-button" href="https://twitter.com/share" 
data-url="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241" data-text="ETロボコンにおける自己位置計測（その２、方位計編） with EV3 by @PsychoGundam009 on @Qiita">ツイート</A></DIV>
<DIV class="socialButtons_hatebu"><A title="はてブに追加" class="hatena-bookmark-button" 
href="http://b.hatena.ne.jp/entry/http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241" 
data-hatena-bookmark-title="ETロボコンにおける自己位置計測（その２、方位計編） with EV3" 
data-hatena-bookmark-layout="simple-balloon"><IMG width="20" height="20" style="border: currentColor; border-image: none;" 
alt="はてブに追加" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/button-only@2x.png"></A>
<SCRIPT src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/bookmark_button.js" type="text/javascript" charset="utf-8" async="async"></SCRIPT>
</DIV>
<DIV class="socialButtons_googlePlus">
<DIV class="g-plusone" data-size="medium" data-href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241"></DIV></DIV>
<DIV class="socialButtons_facebook">
<DIV class="fb-like" data-href="http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241" 
data-show-faces="false" data-share="false" data-layout="button_count" 
data-action="like"></DIV></DIV>
<DIV class="socialButtons_pocket"><A class="pocket-btn" data-lang="en" 
data-pocket-label="pocket" data-pocket-count="horizontal"></A></DIV></DIV></DIV>
<DIV class="itemsShowComment_wrapper" id="comments">
<SCRIPT class="js-react-on-rails-component" type="application/json">{"component_name":"PublicCommentListContainer","props":{"currentUser":null,"initialComments":[],"monthly_public_image_uploadable_size_limit":null,"total_uploaded_public_image_size_in_current_month":null,"item":{"id":455813,"uuid":"4e7de30523d9c7ec6241","suspended":false,"secret":false},"owner":{"url_name":"TetsuroAkagawa"},"is_team":false,"is_project":false,"logged_in":false,"polling":false,"mention_candidates":[{"id":153774,"url_name":"TetsuroAkagawa","profile_image_url":"https://pbs.twimg.com/profile_images/596090876847259648/5QJm6PLv_normal.jpg"}]},"trace":false,"dom_id":"PublicCommentListContainer-react-component-74c967a2-ca9d-401b-8966-d6758f019195"}</SCRIPT>
     
<DIV id="PublicCommentListContainer-react-component-74c967a2-ca9d-401b-8966-d6758f019195"></DIV></DIV></DIV></DIV></DIV></ARTICLE>
<DIV class="js-report-form modal fade reportForm">
<DIV class="modal-dialog">
<DIV class="modal-content">
<DIV class="modal-header"><BUTTON name="button" class="close" type="submit" 
data-dismiss="modal">×</BUTTON>
<H4 class="modal-title">問題がある投稿を報告する</H4></DIV>
<DIV class="modal-body">
<FORM action="/reports" method="post" 
accept-charset="UTF-8"><INPUT name="utf8" type="hidden" value="✓"><INPUT name="authenticity_token" type="hidden" value="2InqJX+BZO2e1Z/qyZDh1RLcxjIR6trDp+UCWFJWCkIfXAGtArxYAwjemftMRfZbayfYirDQ19KvTNzfVvQKyA=="><INPUT name="redirect_path" id="redirect_path" type="hidden" value="/TetsuroAkagawa/items/4e7de30523d9c7ec6241"><INPUT name="item_uuid" id="item_uuid" type="hidden" value="4e7de30523d9c7ec6241">
<P>この投稿にどのような問題がありますか？</P><BR>
<DIV class="form-group">
<UL class="list-unstyled">
  <LI><LABEL><INPUT name="report_type" id="report_type_spam" required="required" 
  type="radio" value="spam"> スパムです </LABEL></LI>
  <LI><LABEL><INPUT name="report_type" id="report_type_harassment" required="required" 
  type="radio" value="harassment"> 攻撃的または迷惑な内容を含んでいます </LABEL></LI>
  <LI><LABEL><INPUT name="report_type" id="report_type_inappropriate_content" 
  required="required" type="radio" value="inappropriate_content"> 不適切な内容を含んでいます 
  </LABEL></LI></UL></DIV>
<DIV class="reportForm_submitButtonContainer"><BUTTON name="button" class="btn btn-primary reportForm_submitButton" 
type="submit"><I class="fa fa-send"></I> 
送信</BUTTON></DIV></FORM></DIV></DIV></DIV></DIV>
<SCRIPT id="js-item" type="application/json">{ "url": "http://qiita.com/TetsuroAkagawa/items/4e7de30523d9c7ec6241", "id": 455813, "uuid": "4e7de30523d9c7ec6241" }</SCRIPT>

<SCRIPT class="js-user" type="application/json">{&quot;id&quot;:153774,&quot;url_name&quot;:&quot;TetsuroAkagawa&quot;,&quot;profile_image_url&quot;:&quot;https://pbs.twimg.com/profile_images/596090876847259648/5QJm6PLv_normal.jpg&quot;}</SCRIPT>

<SCRIPT language="JavaScript" src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/qiita_bigmining.js" type="text/javascript"></SCRIPT>
</DIV><FOOTER class="footer">
<DIV class="footer_inner">
<DIV class="footer_container">
<UL class="footer_links-left">
  <LI class="footer_link"><A class="footer_copyright" href="http://increments.co.jp/">© 
  2011-2017 Increments Inc.</A></LI>
  <LI class="footer_link"><A href="http://qiita.com/terms">利用規約</A></LI>
  <LI class="footer_link"><A href="http://qiita.com/privacy">プライバシー</A></LI>
  <LI class="footer_link"><A href="http://help.qiita.com/">ヘルプ</A></LI>
  <LI class="footer_link"><A href="https://increments.zendesk.com/anonymous_requests/new">お問い合わせ</A></LI></UL>
<UL class="footer_links-right">
  <LI class="footer_link"><A href="http://qiita.com/about">Qiitaとは</A></LI>
  <LI class="footer_link"><A href="http://qiita.com/users">ユーザー</A></LI>
  <LI class="footer_link"><A href="http://qiita.com/tags">タグ</A></LI>
  <LI class="footer_link"><A href="http://blog.qiita.com/">ブログ</A></LI>
  <LI class="footer_link"><A href="http://qiita.com/api/v2/docs">API</A></LI>
  <LI class="footer_link"><A href="https://teams.qiita.com/">Team</A></LI>
  <LI class="footer_link"><A href="http://kobito.qiita.com/">Kobito</A></LI>
  <LI class="footer_link"><A class="js-public-form-feedback-link" href="http://qiita.com/TetsuroAkagawa/items/" 
  data-toggle="modal" data-target=".js-feedback-form"><I 
  class="fa fa-heart"></I> ご意見 <I 
class="fa fa-caret-down"></I></A></LI></UL></DIV></DIV></FOOTER>
<DIV class="js-feedback-form modal fade feedbackForm">
<DIV class="modal-dialog">
<DIV class="modal-content">
<DIV class="modal-header"><BUTTON name="button" class="close" type="submit" 
data-dismiss="modal">×</BUTTON>
<H4 class="modal-title">ご意見</H4></DIV>
<DIV class="modal-body">
<FORM class="js-feedback-form-form" action="/feedbacks" method="post" 
accept-charset="UTF-8"><INPUT name="utf8" type="hidden" value="✓"><INPUT name="authenticity_token" type="hidden" value="j9Cb0n4SZxaOdU8RlQ0BzvgGeXfZDNJV1GN6gEiFDjBIBXBaAy9b+Bh+SQAQ2BZAgf1nz3g230TcyqQHTCcOug=="><INPUT name="redirect_path" id="redirect_path" type="hidden" value="/TetsuroAkagawa/items/4e7de30523d9c7ec6241">
<DIV class="form-group"><TEXTAREA name="feedback[message]" class="form-control js-feedback-form-text-area" id="feedback_message" required="required" placeholder="Qiitaについてのご意見をお聞かせください。" rows="5">Qiitaについてのご意見をお聞かせください。</TEXTAREA></DIV>
<DIV class="feedbackForm_submitButtonContainer"><BUTTON name="button" class="btn btn-primary feedbackForm_submitButton" 
type="submit"><I class="fa fa-send"></I> 送信</BUTTON>
<P class="feedbackForm_note">いただいたご意見への返信は行っておりません。<BR>返信の必要な内容については、<A href="https://increments.zendesk.com/anonymous_requests/new">こちら</A> 
からお問い合わせください。</P></DIV>
<DIV style="top: -99999px; position: fixed; opacity: 0.0001;"><INPUT name="feedback[name]" type="text"></DIV></FORM></DIV></DIV></DIV></DIV>
<SCRIPT>// if (window.mixpanel instanceof Element) {
//   window.mixpanel = [];
// }
// (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
// for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);</SCRIPT>

<SCRIPT src="ETロボコンにおける自己位置計測（その２、方位計編）%20with%20EV3%20-%20Qiita.files/public-ea9634d328dd01703100922f07784313.min.js"></SCRIPT>

<SCRIPT>
  (function () {
    var script = document.getElementsByTagName('script')[0];
    var load = function (src, id) {
      var el = document.createElement('script');
      el.async = true;
      el.src = src;
      el.id = id;
      script.parentNode.insertBefore(el, script);
    };
      // Optimizely
      load('//cdn.optimizely.com/js/52738645.js', 'optimizely-jssdk');
      // Google Analytics
      window._gaq = window._gaq || [];
      var isCareer = location.hostname.split('.')[0] == 'career';
      if (isCareer) {
        window._gaq.push(['_setAccount', 'UA-24675221-11']);
        window._gaq.push(['_setDomainName', 'qiita.com']);
      } else {
        window._gaq.push(['_setAccount', 'UA-24675221-1']);
      }
      window._gaq.push(['_setCustomVar', 1, 'logged_in', 'false', 2]);
      window._gaq.push(['_trackPageview']);
      var src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      load(src, 'google-analytics-jssdk');
    // Google Analytics - Universal Analytics
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-24675221-12', {
          
        });
          ga('create', 'UA-90226750-1', { name: 'user' });
          ga('user.send', 'pageview');
        ga('set', 'dimension1', 'false');
        ga('set', 'dimension3', 'false');
      ga('require', 'displayfeatures');
      ga('set', 'forceSSL', true);
      ga('send', 'pageview');
    // Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TBQWPN');
  })();
</SCRIPT>
 </BODY></HTML>
